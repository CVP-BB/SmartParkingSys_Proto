CREATE DATABASE IF NOT EXISTS sps_db CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE sps_db;

CREATE TABLE IF NOT EXISTS tickets (
  id INT AUTO_INCREMENT PRIMARY KEY,
  ticket_uid VARCHAR(80) UNIQUE NOT NULL,
  owner VARCHAR(100) NOT NULL,
  plate VARCHAR(50) NOT NULL,
  vtype VARCHAR(50),
  floor VARCHAR(50),
  zone VARCHAR(80),
  zone_code CHAR(1),
  slot_number INT,
  active TINYINT(1) DEFAULT 1,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS logs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  ticket_uid VARCHAR(80) NOT NULL,
  event_type ENUM('entry','exit') NOT NULL,
  owner_snapshot VARCHAR(100),
  plate_snapshot VARCHAR(50),
  vtype_snapshot VARCHAR(50),
  floor_snapshot VARCHAR(50),
  zone_snapshot VARCHAR(80),
  zone_code_snapshot CHAR(1),
  slot_number_snapshot INT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (ticket_uid) REFERENCES tickets(ticket_uid) ON DELETE CASCADE
);
